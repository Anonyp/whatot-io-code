<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>转:怎样为Linux内核打补丁 | Whatot 日常积累</title>
  <meta name="author" content="whatot">
  
  <meta name="description" content="whatot blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="转:怎样为Linux内核打补丁"/>
  <meta property="og:site_name" content="Whatot 日常积累"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Whatot 日常积累" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Whatot 日常积累</a></h1>
  <h2><a href="/">积累每一天，无论是技术还是生活</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/archives">存档</a></li>
    
      <li><a href="/links">链接</a></li>
    
      <li><a href="/tools">工具集</a></li>
    
      <li><a href="/about">关于</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-06-30T10:47:32.000Z"><a href="/pub/kernel/kernel/转:怎样为Linux内核打补丁/">6月 30 2013</a></time>
      
      
  
    <h1 class="title">转:怎样为Linux内核打补丁</h1>
  

    </header>
    <div class="entry">
      
        <p>原文应该是 Documentation/applying-patches.txt 的翻译。</p>
<p>原文：<br><a href="http://hi.baidu.com/xu520zl/item/113fa575bbac552b5c178912" target="_blank">怎样为Linux内核打补丁 2007-08-02</a></p>
<p>可以参考：<br><a href="http://hi.baidu.com/sanitywolf/item/83d4c2c41a02432846d5c019" target="_blank">AirWolf-怎样为Linux内核打补丁</a><br><a href="http://hi.baidu.com/thinkinginlamp/item/0ba1d051319b5ac09e2667f8" target="_blank">十分钟掌握diff&amp;patch用法</a></p>
<a id="more"></a>

<p><strong>kernel补丁的命名规则</strong></p>
<p>举例说明：<br>都可以使用-R版本反转</p>
<ul>
<li>patch-2.6.27.47    —用于linux-2.6.27，将版本修改为linux-2.6.27.47</li>
<li>patch-2.6.27        —用于linux-2.6.26，将版本修改为linux-2.6.27</li>
<li>patch-2.6.27.47-48    —用于linux-2.6.27.47，将版本修改为linux-2.6.27.48</li>
<li>patch-3.9.6        —用于linux-3.9.0，将版本修改为linux-3.9.6</li>
</ul>
<p><strong>如果有任何疑问可以查看patch中Makefile段</strong></p>
<p>比如： patch-3.9.6</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>diff --git a/Makefile b/Makefile
index 8fe6991..4a40307 100644
<span class="header">--- a/Makefile</span>
<span class="header">+++ b/Makefile</span>
<span class="chunk">@@ -1,8 +1,8 @@</span>
 VERSION = 3
 PATCHLEVEL = 9
<span class="deletion">-SUBLEVEL = 0</span>
<span class="addition">+SUBLEVEL = 6</span>
 EXTRAVERSION =
<span class="deletion">-NAME = Unicycling Gorilla</span>
<span class="addition">+NAME = Black Squirrel Wakeup Call</span>

 # *DOCUMENTATION*
 # To see a list of typical targets execute "make help"
</pre></td></tr></table></figure>

<p>可以看出子版本号SUBLEVEL从0到6</p>
<hr>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="class">Applying</span> <span class="class">Patches</span> <span class="class">To</span> <span class="class">The</span> <span class="class">Linux</span> <span class="class">Kernel</span>
<span class="class">Original</span> <span class="method">by:</span> <span class="class">Jesper</span> <span class="class">Juhl</span>, <span class="class">August</span> <span class="number">2005</span>
<span class="class">Last</span> <span class="method">update:</span> <span class="number">2006</span>-<span class="number">01</span>-<span class="number">05</span>
</pre></td></tr></table></figure>

<p>在Linux内核邮件列表中一个经常被问到的问题就是怎样为Linux内核打一个补丁，或者更具体一点说，存在这么多的主干/分支，一个补丁到底要打在哪个版本的基础内核上。希望这篇文档能够为你解释明白这一点。</p>
<p>除了解释怎样应用以及卸载补丁以外，在这里还提供了一个不同内核树(以及如何为它们打上特<br>定补丁)的简要介绍。</p>
<h2>什么是补丁？</h2>
<p>一个补丁就是一个文本文档，这个文档包含了在两个不同版本的源代码树之间的变化。<br>补丁是通过diff应用程序来创建的。</p>
<p>为了正确地打上一个补丁，你需要知道这个补丁是从哪个基础版本产生出来的以及这个补丁将要把目前的源代码树变化到什么新的版本。这些信息或者会出现在补丁文件的原数据中，或者可能从文件名中推断出来。</p>
<h2>怎样打补丁和卸载补丁</h2>
<p>可以使用patch程序来打一个补丁。patch程序读取一个diff(或者patch)文件，然后把文件中<br>描述的变化内容应用到代码树上。</p>
<p>Linux内核中的补丁是相对于保存内核源代码目录的父目录而生成的。</p>
<p>这就意味着：patch文件中的文件路径包含了它所基于的内核源文件目录的名字(或者像是“a/”和“b/”之类的其它名字)。</p>
<p>由于这很可能和你本地机器上的内核源代码目录的名字不匹配(但是对于查看一个没有标签的补丁所基于的内核版本是非常有用的)。你应该切换到你的内核源代码目录，并且在打补丁的时候去掉patch中文件名字路径的第一个分量(patch命令的-p1参数可以完成这个任务)。</p>
<p>为了卸载掉一个以前已经打上的补丁，使用-R参数来打补丁。</p>
<p>于是，如果你使用如下的命令来打补丁:</p>
<pre><code><span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">x</span>.<span class="comment">y</span>.<span class="comment">z</code></pre>
<p>那么你可以像下面这样来卸载掉这个补丁：</p>
<pre><code><span class="comment">patch</span> <span class="literal">-</span><span class="comment">R</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">x</span>.<span class="comment">y</span>.<span class="comment">z</code></pre>
<h2>我怎样把一个patch/diff文件加到一个patch中去？</h2>
<p>这个可以通过很多种不同的方法来办到(像是Linux以及其它的类Unix操作系统一样)。</p>
<p>在下面所有的例子中，我把这个文件(未压缩)以下面的语法通过标准输入加入到patch中:</p>
<pre><code><span class="keyword">patch</span> -p1 &lt; path/to/<span class="keyword">patch</span>-x.y.z</code></pre>
<p>如果你只是想能够照着下面的例子而并不想知道其它的打补丁的方法的话，那么你就可以不阅读这一节余下的内容了。</p>
<p>也可以通过patch的-i参数来获得文件的名字，就像下面这样：</p>
<pre><code>patch -p1 -<span class="built_in">i</span> path/to/patch-<span class="transposed_variable">x.</span><span class="transposed_variable">y.</span>z</code></pre>
<p>如果你的patch文件是使用gzip或者bzip2来压缩的，那么你在使用之前就不必解压缩了，你可以像下面这样把它加入到patch文件中：</p>
<pre><code>zcat path/to/patch-x<span class="variable">.y</span><span class="variable">.z</span><span class="variable">.gz</span> | patch -p1
bzcat path/to/patch-x<span class="variable">.y</span><span class="variable">.z</span><span class="variable">.bz2</span> | patch -p1</code></pre>
<p>如果你想在打补丁之前，手动解压缩这个patch文件，那么你就可以对这个文件进行gunzip或者bunzip2操作—-就像下面这样：</p>
<pre><code>gunzip patch-x<span class="variable">.y</span><span class="variable">.z</span><span class="variable">.gz</span>
bunzip2 patch-x<span class="variable">.y</span><span class="variable">.z</span><span class="variable">.bz2</span></code></pre>
<p>这个将会给你一个无格式的文本patch-x.y.z文件，这时候你就可以把这个东西以你喜欢的方式通过标准输入或者是-i参数来加入到patch中。</p>
<p>一些其它的比较好的参数是-s，这个参数使patch保持无输出而不是输出错误，这将阻止错误在屏幕上滚动的速度太快。—dry-run参数使得patch命令仅仅打印出来一个将要打的patch的列表，没有真正的做任何变动。最后，-verbose告诉patch命令打印出正在进行的工作的更多信息。</p>
<h2>打补丁时候的常见错误</h2>
<p>当用patch命令来打一个补丁的时候，它试图以不同的方法来验证这个文件的完整性。</p>
<p>检查这个文件是一个有效的patch文件并且检查这些被改变周围的代码是不是和提供的上下文相匹配。这些仅仅是patch所作的两个最基本的完整性检查。</p>
<p>如果patch遇到了一些看起来不正确的事情，那么它有两种选择。它可以拒绝应用这些改变并且异常中断或者它试图找到一个方法来使patch命令仅仅做一些比较小的改变。</p>
<p>一个patch试图修正错误的例子就是：如果所有的上下文都匹配，被改变的行匹配，但是这些行的行号不匹配。这是可能发生的，例如，如果patch在一个文件的中间做了一些改变，但是出于一些原因在文件的开头处一些行被添加了进来或者被删除了。在这种情况下，一切看起来都很好，它只是简单地上下移动一点，这时候patch通常会修正这些行号并且打上这个补丁。</p>
<p>任何时候，只要patch在打补丁的时候需要改动文件的一些内容，它就会告诉你说：<br>这个补丁打得有点儿混乱。你应该对这些改变保持一些警惕，因为即使补丁很可能被正确地打上了，但是情况并不总是这样，有些情况下结果会是错误的。</p>
<p>当patch命令遇到一个变化而不能进行使用一种模糊的方法进行弥补的时候，它就会彻底地放弃这个动作，并且留下来一个以.rej为扩展名的文件。你可以阅读这个文件来查看到底是什么改变不能进行下去，从而在你愿意的情况下来手动修补它。</p>
<p>如果你的内核源代码上没有应用任何第三方的补丁，只是一些来自kernel.org的补丁，并且你打这些补丁的顺序是正确的，而且你自己没有对这些源文件进行改动过，那么你应该就不会看到一个补丁对这个文件的模糊的改变或者是一些拒绝消息。如果你确实看到了这些消息的话，那么将有非常高的危险性，这说明或者是你的本地的源代码书或者是补丁文件在某些方面被玷污了。在这种情况下，你很可能是应该重新下载这个补丁文件，如果事情仍然还是保持原样的话，那么我建议你去尝试从kernel.org上下载一个完整的新的源代码树。</p>
<p>让我们来看一下补丁可能产生的更多信息。</p>
<ul>
<li><p>如果patch命令停下来并且显示一个“File to patch”的提示符，那么这个时候patch命令找不到要打补丁的文件。很可能的情况是你忘记指定-p1参数或者你处于一个错误的目录中了。更加不常见的一种情况是，你会发现一些补丁需要使用-p0参数而不是-p1参数来打补丁(阅读这个补丁文件应该能揭示出这些信息—如果是这样的话，这是一种创建补丁文件的人所犯的错误，但是不致命)</p>
</li>
<li><p>如果你得到信息“Hunk #2 succeeded at 1887 with fuzz 2 (offset 7 lines)”，或者是一个类似的消息，那就意味着patch命令必须调整改变的位置（在这个例子中，它需要在它想打补丁的地方移动7行来适应这个补丁）。结果得到的文件可能正确也可能不正确，这决定于这个文件与所期望的文件不相同的原因。</p>
</li>
</ul>
<p>这常常发生于你所要打的patch产生于一个另外一个内核版本，这个内核版本和你要打的patch所基于的内核版本不同。</p>
<ul>
<li><p>如果你得到一个类似于“Hunk #3 FAILED at 2387”之类的消息，那么这就意味着不能正确地打上这个补丁，并且patch程序也不能模糊地通过。这将产生一个导致patch失败的.rej文件并且产生一个.orig文件把一些不能改变的原始内容显示给你。</p>
</li>
<li><p>如果你得到的信息是：“Reversed (or previously applied) patch detected! Assume -R? [n]”，那么patch检测到了这个补丁文件中包含的改变已经应用在了目标文件上。如果你确实已经在此之前打了这个补丁并且重新打补丁遇到了错误，那么你可以简单地选择[n]o并且终止这次补丁动作。如果你之前打了补丁并且想得到打补丁以前的版本，但是忘记了指定-R参数，那么你在这里可以回答[y]es来使用patch为你恢复它。这也可能发生在补丁文件的创建者在创建补丁文件的时候倒置了源文件和目标目录的位置，</p>
</li>
</ul>
<p>在这种情况下从patch中revert实际上是打上了这个补丁。</p>
<ul>
<li>一个类似于“patch: <em>**</em> unexpected end of file in patch”或者“patch unexpectedly ends in middle of line”的消息意味着patch命令对你加入到它之中的文件觉得没有意义。或者是你的下载被打断了，你试图打上一个没有压缩的patch文件，而事前并没有解压缩它，或者是你使用的补丁文件在传输的某个地方被一个邮件客户端或者一个邮件传输代理给损坏了。例如，通过把一个长行分成两行。通常情况下这些警告可以通过把这两个被分开的行合并起来来解决。</li>
</ul>
<p>就像我上面提到的那样，如果你打的是从kernel.org得来的补丁到一个正确的版本，<br>并且你没有修改过源代码树，这些错误将从来不会发生。因此如果你从kernel.org来的<br>补丁上得来了这些错误，那么你应该很可能认为或者是你的补丁文件或者是源代码树<br>损坏掉了。我建议你重新开始下载一个完整的内核树以及你想要打的补丁。</p>
<h2>有patch的替代品么？</h2>
<p>是的，有一些替代品。</p>
<p>你可以使用“interdiff”程序(<a href="http://cyberelk.net/tim/patchutils/" target="_blank">http://cyberelk.net/tim/patchutils/</a>) 来产生一个文件来表示两个补丁文件之间之间的不同，然后打上这个文件。这可以使你从一个像2.6.12.2的版本一步就可以到达版本2.6.12.3。-z标志甚至可以使你送给interdiff一些使用gzip或者bzip2压缩的格式文件而不用使用zcat或者bzcat或者手动解压缩。</p>
<p>下面展示了你可以怎样一步就可以从2.6.12.2到达2.6.12.3</p>
<pre><code><span class="comment">interdiff</span> <span class="literal">-</span><span class="comment">z</span> <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">2</span>.<span class="comment">bz2</span> <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">3</span>.<span class="comment">gz</span> <span class="comment">|</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</code></pre>
<p>尽管interdiff可以节省一到两步，但是我还是建议你通常情况下应该做这些附加的步骤，<br>这是由于在某些情况下interdiff会把事情弄糟。</p>
<p>另外的一个替代品是“ketchup”，是一个使用python写的脚本，这个脚本可以自动下载和打上一些补丁 (<a href="http://www.selenic.com/ketchup/" target="_blank">http://www.selenic.com/ketchup/</a>).</p>
<p>另外一些比较好的工具是diffstat,可以显示patch所作的所有改变的总结；lsdiff，可以显示<br>在一个patch文件中受影响的文件的简短列表，以及(可选)每一个补丁的行号码；grepdiff，可<br>以显示在补丁包含给定的正则表达式的时候显示一个被补丁文件修改的文件的列表。</p>
<h2>我可以从哪儿下载这些补丁？</h2>
<p>补丁文件可以从 (<a href="http://kernel.org/" target="_blank">http://kernel.org/</a>) 来获得最近的补丁文件可以从首页的链接中得到，但是他们也有自己的特定的主页。</p>
<p>2.6.x.y (-stable) 和 2.6.x 补丁位于：<br> ftp://ftp.kernel.org/pub/linux/kernel/v2.6/</p>
<p>-rc 补丁位于：<br> ftp://ftp.kernel.org/pub/linux/kernel/v2.6/testing/</p>
<p>-git 补丁位于：<br> ftp://ftp.kernel.org/pub/linux/kernel/v2.6/snapshots/</p>
<p>-mm 补丁位于：<br> ftp://ftp.kernel.org/pub/linux/kernel/people/akpm/patches/2.6/</p>
<p>在ftp.kernel.org中，你可以使用ftp.cc.kernel.org,这里cc是一个国家的代码。这样你就可以从一个在地理上离你比较近的位置的镜像站点下载，从而使你获得较快的下载速度，全局上更少的带宽以及对于kernel.org主服务器的更小的压力—-这是比较好的事情，所以你还是在可能的时候使用这些镜像站点。</p>
<h2>2.6.x内核</h2>
<p>这是Linus发布的基础稳定版本.发布的最高版本是最新的。</p>
<p>如果发现了冲突或者严重的瑕疵，那么在这个基础上，一个-stable的修正补丁就会被发布<br>出来(参见下面)。一旦一个新的2.6.x的基础内核发布出来，就可以得到一个测试版本的补丁<br>，这个补丁基于先前的2.6.x版本内核和这个新的内核。</p>
<p>为了应用一个从2.6.11到2.6.12的补丁，你最好按照下面来做(注意这些补丁不能应用于2.6.x.y的内核，而是应用在2.6.x的基础内核—-如果你需要从2.6.x.y到2.6.x+1,那么你首先需要卸载掉2.6.x.y的补丁)</p>
<p>下面是一些例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="preprocessor"># 从2.6.11到2.6.12</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.11</span>			<span class="preprocessor"># 切换到内核源代码目录</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.12</span>		<span class="preprocessor"># 应用2.6.12补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.11</span> linux-<span class="number">2.6</span><span class="number">.12</span>		<span class="preprocessor"># 重命名源代码目录</span>

<span class="preprocessor"># 从2.6.11.1到2.6.12</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.11</span><span class="number">.1</span>			<span class="preprocessor"># 切换到内核源代码目录</span>
$ <span class="keyword">patch</span> -p1 -R &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.11</span><span class="number">.1</span>	<span class="preprocessor"># 恢复出来2.6.11.1</span>
					<span class="preprocessor"># 源代码目录现在是2.6.11</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.12</span>		<span class="preprocessor"># 应用新的2.6.12补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.11</span><span class="number">.1</span> linux-<span class="number">2.6</span><span class="number">.12</span>	<span class="preprocessor"># 重命名源代码目录</span>
</pre></td></tr></table></figure>

<h2>2.6.x.y内核</h2>
<p>带有四位数字版本号的内核是-stable的内核。他们包含了对一个给定的2.6.x内核的一些安全<br>问题以及发现的重要的退化的修复。</p>
<p>对于那些想要最近的稳定内核并且对于测试开发中的试验性的版本没有兴趣的用户来说，我们推荐这个分支。</p>
<p>如果没有可用的2.6.x.y内核，那么最高数字的2.6.x内核是目前的稳定内核。</p>
<p>注意：维护稳定内核的团队通常会做一些增量的补丁，就像是基于最近的主流版本发布的补丁一样。但是在下面我仅仅说明了非增量的情况。那些增量式的版本可以在下面的ftp处找到:</p>
<p>这些补丁不是增量式的，意味着例如对于2.6.12.3补丁不能应用于2.6.12.2的内核源代码上去，但是可以应用在2.6.12内核代码上。</p>
<p>因此，为了为了把2.6.12.3的补丁应用到你使用的2.6.12.2的内核源代码上，你不得不卸载掉2.6.12.2补丁(因此你可以得到一个基础的2.6.12的内核源代码)，并且应用新的2.6.12.3补丁。</p>
<p>下面是一个小例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">$</span> <span class="comment">cd</span> <span class="comment">~/linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">2			#</span> <span class="comment">切换到内核源代码目录</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> <span class="literal">-</span><span class="comment">R</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">2	#</span> <span class="comment">回归2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">2补丁</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">3		#</span> <span class="comment">应用新的2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">3补丁</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="string">.</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">mv</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">2</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>.<span class="comment">3	#</span> <span class="comment">重新命名内核源代码目录
</pre></td></tr></table></figure>

<h2>-rc内核</h2>
<p>这些是候选的发布内核。当Linus认为目前的git(内核的源代码管理工具)内核树处于一个健全的稳定状态足以用来测试的时候，而发布的开发内核。</p>
<p>这些内核是不稳定的，如果你试着运行他们应该会想到可能会不时地有问题出现。<br>但是这是主开发分支上的最稳定的内核，并且最终会变成下一个稳定的内核。因此让尽可能多的人来测试它就显得格外重要。</p>
<p>对于那些想帮忙测试开发中的内核但是又不想跑那些试验性的东西的人来说，这将是一个非常好的分支。(这样的人应该参照下面的关于-git和-mm内核的部分)</p>
<p>-rc补丁是非增量式的，他们应用于2.6.x内核上，就像上面描述的2.6.x.y内核一样。在-rcN后缀之前的内核版本号代表了这个-rc的内核最终会变成的内核版本。</p>
<p>因此，2.6.13-rc5意思是这是2.6.13内核的第五个候选的发布版本，并且这个补丁应该打在2.6.12的内核源代码上。</p>
<p>下面是3个关于怎样打这些补丁的例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="preprocessor"># 首先是一个从2.6.12到2.6.13-rc3的例子</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.12</span>			<span class="preprocessor"># 切换到2.6.12的源代码目录</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc3	<span class="preprocessor"># 打上2.6.13-rc3的补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.12</span> linux-<span class="number">2.6</span><span class="number">.13</span>-rc3	<span class="preprocessor"># 重新命名源代码目录</span>

<span class="preprocessor"># 现在从2.6.13-rc3迁移到2.6.13-rc5</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.13</span>-rc3			<span class="preprocessor"># 切换到2.6.12的源代码目录</span>
$ <span class="keyword">patch</span> -p1 -R &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc3	<span class="preprocessor"># 卸载掉2.6.13-rc3补丁</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc5	<span class="preprocessor"># 应用新的2.6.13-rc5补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.13</span>-rc3 linux-<span class="number">2.6</span><span class="number">.13</span>-rc5	<span class="preprocessor"># 重新命名源代码目录</span>

<span class="preprocessor"># 最后让我们试着从2.6.12.3到2.6.13-rc5</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.12</span><span class="number">.3</span>			<span class="preprocessor"># 切换到内核源代码目录</span>
$ <span class="keyword">patch</span> -p1 -R &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.12</span><span class="number">.3</span>	<span class="preprocessor"># 回返2.6.12.3补丁</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc5	<span class="preprocessor"># 应用新的2.6.13-rc5补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.12</span><span class="number">.3</span> linux-<span class="number">2.6</span><span class="number">.13</span>-rc5	<span class="preprocessor"># 重新命名源代码目录</span>
</pre></td></tr></table></figure>

<h2>-git内核</h2>
<p>这些是每天Linus的内核树的快照(在一个git仓库中管理着，因此得名)。</p>
<p>这些补丁通常每天都发布而且代表了的Linus的内核树的当前状态，由于它们是自动产生的甚至没有任何一个光标的骚动来看它们是不是健全的，所以它们比-rc内核更具有试验性。</p>
<p>-git补丁不是增量的，它们或者是应用在2.6.x内核上或者是应用在一个基础的2.6.x-rc内核上—-这一点你可以从他们的名字上看出来。一个名字是2.6.12-git1的补丁应用在2.6.12内核源代码上，一个名字为2.6.13-rc3-git2的补丁应用在2.6.13-rc3的内核源代码上。</p>
<p>这里是一些怎样打这些补丁的例子：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="preprocessor"># 从2.6.12迁移到2.6.12-git1</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.12</span>			<span class="preprocessor"># 切换到内核源代码目录</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.12</span>-git1	<span class="preprocessor"># 应用2.6.12-git1补丁</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.12</span> linux-<span class="number">2.6</span><span class="number">.12</span>-git1	<span class="preprocessor"># 重新命名内核源代码目录</span>

<span class="preprocessor"># 从2.6.12-git1迁移到2.6.13-rc2-git3</span>
$ cd ~/linux-<span class="number">2.6</span><span class="number">.12</span>-git1		<span class="preprocessor"># 切换到内核源代码目录</span>
$ <span class="keyword">patch</span> -p1 -R &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.12</span>-git1	<span class="preprocessor"># 回返2.6.12-git1补丁</span>
<span class="preprocessor"># 我们现在有了一个2.6.12内核</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc2	<span class="preprocessor"># 打上2.6.13-rc2补丁</span>
<span class="preprocessor"># 内核现在是2.6.13-rc2</span>
$ <span class="keyword">patch</span> -p1 &lt; ../<span class="keyword">patch</span>-<span class="number">2.6</span><span class="number">.13</span>-rc2-git3	<span class="preprocessor"># 打上2.6.13-rc2-git3补丁</span>
<span class="preprocessor"># 内核现在是2.6.13-rc2-git3</span>
$ cd ..
$ mv linux-<span class="number">2.6</span><span class="number">.12</span>-git1 linux-<span class="number">2.6</span><span class="number">.13</span>-rc2-git3 <span class="preprocessor"># 重新命名内核源代码目录</span>
</pre></td></tr></table></figure>

<h2>-mm内核</h2>
<p>这是Andrew Morton发布的实验性的内核</p>
<p>-mm树作为一个新特性和实验性的补丁的实验场。一旦一个补丁在-mm中经过一段时间被证明有价值，为了使它能包含在主流内核中，Andrew就会把它推给Linus。</p>
<p>尽管鼓励的方法是通过-mm树把补丁推给Linus，这个步骤并不是总被实行。子系统的维护者(或者个人)有些时候直接把补丁推给Linus，尽管(或者之后)它们已经被它并到了-mm中并得到了测试(或者有些时候并没有事前在-mm中得到测试)。</p>
<p>通常情况下你应该尽力使你的补丁通过-mm中最大程度测试后再到达主流内核中。</p>
<p>这个分支是一个持续的变化并且包含了一些实验性的特征，很多正在debug的补丁并不适合于主流的内核等等。这个分支是这个文档中描述的最具有试验性的分支。</p>
<p>这些内核内核不适合于应用在要求稳定的系统上面，并且在运行中比其他任何的分支都可能承担更大的风险(确信你有最新的备份—-这对于任何实验性的内核都适用，但是对于-mm更是这样)。</p>
<p>这些内核除了包含所有的试验性的补丁以外，它们还包含了在主流-git内核发布的时候任何可用的改变。</p>
<p>对-mm内核测试会得到极大的赏识，因为这个分支的总的目的就是为了在改变被加到更加稳定的主流的Linus内核树之前，消除退化、死机、数据失败bug、build失败(以及任何通常意义上的bug)。</p>
<p>但是-mm的测试者应该清醒地认识到这个源代码树中的失败会比其他任何树中的都要普遍。</p>
<p>-mm内核并不会以一个固定的时间发布，但是通常一些-mm内核会在每一个-rc内核(通常1到3个)发布的中间。-mm内核或者是应用于一个基础的2.6.x内核(当还没有-rc内核发布的时候)或者应用于一个Linus -rc的内核。</p>
<p>这里有一个打-mm补丁的例子</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="comment">#</span> <span class="comment">从2</span>.<span class="comment">6</span>.<span class="comment">12到2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="comment">~/linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12			#</span> <span class="comment">切换到2</span>.<span class="comment">6</span>.<span class="comment">12的源文件目录</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1		#</span> <span class="comment">打一个2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1的补丁</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="string">.</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">mv</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1	#</span> <span class="comment">重新正确命名这个源文件</span>

<span class="comment">#</span> <span class="comment">从2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1到2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3</span>-<span class="comment">mm3</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="comment">~/linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> <span class="literal">-</span><span class="comment">R</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1		#</span> <span class="comment">卸载掉2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1补丁</span>
<span class="comment">#</span> <span class="comment">现在我们得到了一个2</span>.<span class="comment">6</span>.<span class="comment">12的源文件</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/patch</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3	#</span> <span class="comment">打一个2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3的补丁</span>
<span class="comment">#</span> <span class="comment">我们现在得到一个2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3的源文件</span>
<span class="comment">$</span> <span class="comment">patch</span> <span class="literal">-</span><span class="comment">p1</span> &lt; <span class="string">.</span><span class="string">.</span><span class="comment">/2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3</span>-<span class="comment">mm3		#</span> <span class="comment">打一个2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3</span>-<span class="comment">mm3的补丁</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="string">.</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">mv</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">12</span>-<span class="comment">mm1</span> <span class="comment">linux</span>-<span class="comment">2</span>.<span class="comment">6</span>.<span class="comment">13</span>-<span class="comment">rc3</span>-<span class="comment">mm3</span> <span class="comment">#</span> <span class="comment">重新命名源文件目录
</pre></td></tr></table></figure>

<p>上面总结了不同内核树的一些解释。我希望你已经明白了怎样打不同的补丁并且对你测<br>试内核有所帮助。</p>
<p>致谢列表：</p>
<p>Randy Dunlap, Rolf Eike Beer, Linus Torvalds, Bodo Eggert,<br>Johannes Stezenbach, Grant Coady, Pavel Machek，还有一些人我可能忘记了他们的名字，<br>但是他们对这篇文档进行了评论或者贡献。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/kernel/">kernel</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/linux/">linux</a>, <a href="/tags/kernel/">kernel</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://whatot.github.io/pub/kernel/kernel/转:怎样为Linux内核打补丁/" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:whatot.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/algorithm/">algorithm</a><small>1</small></li>
  
    <li><a href="/categories/basis/">basis</a><small>1</small></li>
  
    <li><a href="/categories/c/">c</a><small>3</small></li>
  
    <li><a href="/categories/database/">database</a><small>6</small></li>
  
    <li><a href="/categories/fun/">fun</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/kernel/">kernel</a><small>2</small></li>
  
    <li><a href="/categories/linux/">linux</a><small>6</small></li>
  
    <li><a href="/categories/linux_program/">linux_program</a><small>3</small></li>
  
    <li><a href="/categories/program/">program</a><small>1</small></li>
  
    <li><a href="/categories/python/">python</a><small>1</small></li>
  
    <li><a href="/categories/thought/">thought</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/CPU/">CPU</a><small>1</small></li>
  
    <li><a href="/tags/Makefile/">Makefile</a><small>1</small></li>
  
    <li><a href="/tags/algorithm/">algorithm</a><small>1</small></li>
  
    <li><a href="/tags/bash/">bash</a><small>1</small></li>
  
    <li><a href="/tags/c/">c</a><small>3</small></li>
  
    <li><a href="/tags/cache/">cache</a><small>1</small></li>
  
    <li><a href="/tags/career/">career</a><small>1</small></li>
  
    <li><a href="/tags/database/">database</a><small>6</small></li>
  
    <li><a href="/tags/fun/">fun</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/kernel/">kernel</a><small>3</small></li>
  
    <li><a href="/tags/language/">language</a><small>4</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>7</small></li>
  
    <li><a href="/tags/make/">make</a><small>1</small></li>
  
    <li><a href="/tags/math/">math</a><small>1</small></li>
  
    <li><a href="/tags/perf/">perf</a><small>1</small></li>
  
    <li><a href="/tags/program/">program</a><small>7</small></li>
  
    <li><a href="/tags/python/">python</a><small>1</small></li>
  
    <li><a href="/tags/regex/">regex</a><small>1</small></li>
  
    <li><a href="/tags/shell/">shell</a><small>6</small></li>
  
    <li><a href="/tags/thought/">thought</a><small>2</small></li>
  
    <li><a href="/tags/vim/">vim</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/CPU/" style="font-size: 10.00px;">CPU</a><a href="/tags/Makefile/" style="font-size: 10.00px;">Makefile</a><a href="/tags/algorithm/" style="font-size: 10.00px;">algorithm</a><a href="/tags/bash/" style="font-size: 10.00px;">bash</a><a href="/tags/c/" style="font-size: 14.00px;">c</a><a href="/tags/cache/" style="font-size: 10.00px;">cache</a><a href="/tags/career/" style="font-size: 10.00px;">career</a><a href="/tags/database/" style="font-size: 18.00px;">database</a><a href="/tags/fun/" style="font-size: 10.00px;">fun</a><a href="/tags/git/" style="font-size: 10.00px;">git</a><a href="/tags/kernel/" style="font-size: 14.00px;">kernel</a><a href="/tags/language/" style="font-size: 16.00px;">language</a><a href="/tags/linux/" style="font-size: 20.00px;">linux</a><a href="/tags/make/" style="font-size: 10.00px;">make</a><a href="/tags/math/" style="font-size: 10.00px;">math</a><a href="/tags/perf/" style="font-size: 10.00px;">perf</a><a href="/tags/program/" style="font-size: 20.00px;">program</a><a href="/tags/python/" style="font-size: 10.00px;">python</a><a href="/tags/regex/" style="font-size: 10.00px;">regex</a><a href="/tags/shell/" style="font-size: 18.00px;">shell</a><a href="/tags/thought/" style="font-size: 12.00px;">thought</a><a href="/tags/vim/" style="font-size: 10.00px;">vim</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 whatot
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>